<div class="container-fluid bg-light">
  <div class="row my-2 p-2">
    <div class="col">

      <h4 class="float-left text-secondary">Anticipar</h4>
        <button type="button" class="btn btn-primary btn-xs float-right" data-toggle="modal" data-target="#modalPayments">
          Añadir Anticipo
        </button>
    </div>
  </div>
  <div class="row shadow-sm p-2">
    <div class="col">

      <h4 class="float-left">Cartola de Anticipos</h1>
        <button type="button" class="btn btn-primary float-right" data-toggle="modal" data-target="#modalPayments">
          Añadir Anticipo
        </button>
    </div>
  </div>

 <div class="row my-3 p-4">
   

   <div class="col inline-block">
     <%= form_with(url: "/payment", method: 'get', local: true) do %>
     <%= text_field_tag :search, params[:search], autocomplete: "off", placeholder:'Busqueda por nombre' %>
     <% end %>
     <input type="text" id="daterange" class="daterange" />
     
    </div>
  </div>

  <table id="tablaPrepayments" class="table table-borderless" width="100">
      <thead>
          <tr>
              <th>ID</th>
              <th>Deudor</th>
              <th>Fecha</th>
              <th>N° Facturas</th>
              <th>% Anticipo</th>
              <th>Monto Final</th>
              <th>Estado</th>
          </tr>
      </thead>
      <tbody id="tablaPayments">
          <% @payments.each do |ant| %>
              <tr id="payment_<%= ant.id %>">
                  <td>#<%= ant.id %></td>
                  <td><%= ant.deudor %></td>
                  <td><%= ant.created_at.strftime("%d-%m-%Y") %></td>
                  <td><%= ant.numfact %></td>
                  <td><%= ant.pay %>%</td>
                  <td><%= number_with_delimiter(ant.monto_total, :delimiter => '.') %></td>
                  
                  <td>
                    <% if ant.estado === "Pendiente" %>
                      <div class="btn btn-warning">
                        <%= ant.estado %>
                      </div>
                    <% elsif ant.estado === "Aprobado" %>
                      <div class="btn btn-success">
                        <%= ant.estado %>
                      </div>
                    <% else %>
                      <div class="btn btn-danger">
                        <%= ant.estado %>
                      </div>
                  <% end %>
                  </td>
                  <td>
                    <div class="dropdown">
                        
                        <button class="btn btn-light" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-three-dots-vertical" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                          </svg>
                      </button>
                        <div class="dropdown-menu">
                          <%= link_to 'Modificar', edit_payment_path(ant), html_options = {class: "dropdown-item", data_target: "#modificarModel", data_toggle: "modal", remote: true} %>
                            <%= link_to 'Eliminar', ant, remote: true, method: :delete, data: { confirm: "Estás seguro de eliminar el anticipo de #{ant.deudor}?" }, class: "dropdown-item" %>
                        </div>
                      </div>
                  </td>
              </tr>
          <% end %>
      </tbody>

  </table>
</div>

  <%= will_paginate @payments,list_classes: %w(pagination justify-content-center), previous_label: '&laquo;', :next_label => '&raquo;' , renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>

<%= render 'modal_payments' %>


<%= form_tag root_path, method: :get do %>
  <%= hidden_field_tag :start %>
  <%= hidden_field_tag :end %>
<% end %>


<script>
  $(function() {
    $('#daterange').daterangepicker({
      startDate: moment("<%= l @start_date, format: '%Y-%m-%d' %>"),
      endDate: moment("<%= l @end_date, format: '%Y-%m-%d' %>"),
    }, function(start, end, label) {
      $("#start").val(start.format('YYYY-MM-DD'));
      $("#end").val(end.format('YYYY-MM-DD'));

      $("form").submit();
    });
  });
</script>